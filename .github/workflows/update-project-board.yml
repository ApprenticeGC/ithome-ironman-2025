name: Update Project Board

on:
  issues:
    types: [opened, closed, reopened]
  pull_request:
    types: [opened, closed, ready_for_review, converted_to_draft]
  workflow_run:
    workflows: ["Direct Merge PR"]
    types: [completed]

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  update-project:
    runs-on: ubuntu-latest
    steps:
      - name: Add Project Board Comment
        if: github.event_name == 'issues' && github.event.action == 'opened'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            console.log('ğŸ” Project Board Integration Starting...');
            console.log(`Event: ${context.eventName}`);
            console.log(`Action: ${context.payload.action}`);

            const issue = context.payload.issue;
            console.log(`Issue #${issue.number}: ${issue.title}`);

            const isRFC = issue.title.includes('RFC-');
            console.log(`Is RFC issue: ${isRFC}`);

            if (isRFC) {
              console.log('âœ… RFC issue detected - adding project board comment...');

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: 'ğŸ¯ **Project Tracking**: This RFC has been added to the [Project Board](https://github.com/users/ApprenticeGC/projects/2/views/1)\n\n' +
                      'ğŸ“Š **Status**: Added to RFC Backlog\n' +
                      'ğŸ¤– **Next**: Waiting for Copilot implementation\n' +
                      'ğŸ“ˆ **Track Progress**: Monitor on the project board as this issue moves through the automation pipeline\n\n' +
                      '*This comment was automatically added by the Project Board Integration workflow*'
              });

              console.log('âœ… Project board comment added successfully');

              // Future: Add actual Projects v2 API integration here
              console.log('ğŸ“‹ Ready for Projects v2 API integration');
            } else {
              console.log('â„¹ï¸ Not an RFC issue, skipping project board integration');
            }

            console.log('ğŸ¯ Project Board Integration Complete!');
